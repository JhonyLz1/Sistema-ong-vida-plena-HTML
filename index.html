<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONG Vida Plena - Sistema de Gest√£o</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 20px;
            margin-top: 10px;
            font-size: 0.85rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ef4444;
        }

        .status-dot.connected {
            background: #22c55e;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Navigation */
        .nav {
            background: white;
            padding: 0 20px;
            display: flex;
            gap: 5px;
            overflow-x: auto;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .nav-btn {
            padding: 15px 25px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #64748b;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-btn:hover {
            color: #10B981;
            background: #f0fdf4;
        }

        .nav-btn.active {
            color: #10B981;
            border-bottom-color: #10B981;
            background: #f0fdf4;
        }

        /* Main Content */
        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Pages */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            padding: 18px 20px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 1.1rem;
            font-weight: 700;
            color: #1f2937;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .card-body {
            padding: 20px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid;
        }

        .stat-card.green { border-color: #10B981; }
        .stat-card.blue { border-color: #6366f1; }
        .stat-card.yellow { border-color: #f59e0b; }
        .stat-card.red { border-color: #ef4444; }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: #1f2937;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Form */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group.full {
            grid-column: 1 / -1;
        }

        .form-label {
            font-weight: 600;
            font-size: 0.9rem;
            color: #374151;
        }

        .form-label .req {
            color: #ef4444;
        }

        .form-input, .form-select, .form-textarea {
            padding: 12px 14px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #10B981;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #10B981;
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 8px 12px;
            font-size: 0.85rem;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Table */
        .table-wrap {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            padding: 12px 15px;
            text-align: left;
            background: #f9fafb;
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
            color: #6b7280;
            border-bottom: 2px solid #e5e7eb;
        }

        td {
            padding: 14px 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        tr:hover {
            background: #f9fafb;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-green { background: #d1fae5; color: #065f46; }
        .badge-blue { background: #dbeafe; color: #1e40af; }
        .badge-yellow { background: #fef3c7; color: #92400e; }
        .badge-red { background: #fee2e2; color: #991b1b; }
        .badge-purple { background: #ede9fe; color: #5b21b6; }

        /* Config Panel */
        .config-box {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 12px;
            padding: 25px;
            color: white;
            margin-bottom: 20px;
        }

        .config-box h3 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .config-label {
            font-size: 0.85rem;
            margin-bottom: 6px;
            opacity: 0.8;
        }

        .config-input {
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .config-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .config-input:focus {
            outline: none;
            border-color: #10B981;
        }

        /* Toast */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
            border-left: 4px solid;
        }

        .toast.success { border-color: #10B981; }
        .toast.error { border-color: #ef4444; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #9ca3af;
            margin-left: auto;
        }

        /* Empty State */
        .empty {
            text-align: center;
            padding: 50px 20px;
            color: #6b7280;
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav {
                padding: 0 10px;
            }
            .nav-btn {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
            .main {
                padding: 15px;
            }
            .form-actions {
                flex-direction: column;
            }
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="header">
        <h1>üå± ONG Vida Plena</h1>
        <p>Sistema de Gest√£o de Eventos e Benefici√°rios</p>
        <div class="status-badge">
            <span class="status-dot" id="statusDot"></span>
            <span id="statusText">Desconectado</span>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav" id="mainNav">
        <button class="nav-btn active" data-page="dashboard">üìä Dashboard</button>
        <button class="nav-btn" data-page="eventos">üìÖ Eventos</button>
        <button class="nav-btn" data-page="beneficiarios">üë• Benefici√°rios</button>
        <button class="nav-btn" data-page="inscricoes">üìã Inscri√ß√µes</button>
        <button class="nav-btn" data-page="config">‚öôÔ∏è Configura√ß√£o</button>
    </nav>

    <!-- Main Content -->
    <main class="main">

        <!-- DASHBOARD -->
        <div class="page active" id="page-dashboard">
            <div class="stats-grid">
                <div class="stat-card green">
                    <div class="stat-value" id="statEventos">--</div>
                    <div class="stat-label">Eventos Cadastrados</div>
                </div>
                <div class="stat-card blue">
                    <div class="stat-value" id="statBenef">--</div>
                    <div class="stat-label">Benefici√°rios Ativos</div>
                </div>
                <div class="stat-card yellow">
                    <div class="stat-value" id="statInsc">--</div>
                    <div class="stat-label">Inscri√ß√µes Realizadas</div>
                </div>
                <div class="stat-card red">
                    <div class="stat-value" id="statPresenca">--%</div>
                    <div class="stat-label">Taxa de Presen√ßa</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">üìà Pr√≥ximos Eventos</div>
                <div class="card-body">
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Evento</th>
                                    <th>Tipo</th>
                                    <th>Data</th>
                                    <th>Vagas</th>
                                </tr>
                            </thead>
                            <tbody id="tblProximos">
                                <tr><td colspan="4" class="empty">Carregando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- EVENTOS -->
        <div class="page" id="page-eventos">
            <div class="card">
                <div class="card-header">‚ûï Cadastrar Novo Evento</div>
                <div class="card-body">
                    <form id="formEvento">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Nome <span class="req">*</span></label>
                                <input type="text" class="form-input" id="evNome" required placeholder="Ex: Curso de Inform√°tica">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tipo <span class="req">*</span></label>
                                <select class="form-select" id="evTipo" required>
                                    <option value="">Selecione...</option>
                                    <option value="inclusao_digital">üíª Inclus√£o Digital</option>
                                    <option value="capacitacao_profissional">üíº Capacita√ß√£o Profissional</option>
                                    <option value="campanha_saude">üè• Campanha de Sa√∫de</option>
                                    <option value="outro">üìå Outro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Data e Hora <span class="req">*</span></label>
                                <input type="datetime-local" class="form-input" id="evData" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Vagas</label>
                                <input type="number" class="form-input" id="evVagas" value="50" min="1">
                            </div>
                            <div class="form-group full">
                                <label class="form-label">Local</label>
                                <input type="text" class="form-input" id="evLocal" placeholder="Ex: Centro Comunit√°rio">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">üíæ Salvar Evento</button>
                            <button type="reset" class="btn btn-secondary">üîÑ Limpar</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span>üìÖ Eventos Cadastrados</span>
                    <button class="btn btn-secondary btn-sm" id="btnRefreshEv">üîÑ Atualizar</button>
                </div>
                <div class="card-body">
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Tipo</th>
                                    <th>Data</th>
                                    <th>Vagas</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tblEventos">
                                <tr><td colspan="5" class="empty"><div class="empty-icon">üìÖ</div>Nenhum evento</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- BENEFICI√ÅRIOS -->
        <div class="page" id="page-beneficiarios">
            <div class="card">
                <div class="card-header">‚ûï Cadastrar Benefici√°rio</div>
                <div class="card-body">
                    <form id="formBenef">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Nome Completo <span class="req">*</span></label>
                                <input type="text" class="form-input" id="bfNome" required placeholder="Ex: Maria Silva">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Idade</label>
                                <input type="number" class="form-input" id="bfIdade" min="0" max="120" placeholder="Ex: 35">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telefone</label>
                                <input type="tel" class="form-input" id="bfTel" placeholder="(11) 99999-9999">
                            </div>
                            <div class="form-group">
                                <label class="form-label">E-mail</label>
                                <input type="email" class="form-input" id="bfEmail" placeholder="email@exemplo.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Regi√£o <span class="req">*</span></label>
                                <select class="form-select" id="bfRegiao" required>
                                    <option value="">Selecione...</option>
                                    <option value="Guarulhos">Guarulhos</option>
                                    <option value="Osasco">Osasco</option>
                                    <option value="Santo Andr√©">Santo Andr√©</option>
                                    <option value="S√£o Bernardo">S√£o Bernardo do Campo</option>
                                    <option value="Diadema">Diadema</option>
                                    <option value="Mau√°">Mau√°</option>
                                    <option value="Itaquera">Itaquera</option>
                                    <option value="Zona Leste">Zona Leste - SP</option>
                                    <option value="Zona Sul">Zona Sul - SP</option>
                                    <option value="Outra">Outra</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">üíæ Salvar Benefici√°rio</button>
                            <button type="reset" class="btn btn-secondary">üîÑ Limpar</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span>üë• Benefici√°rios Cadastrados</span>
                    <button class="btn btn-secondary btn-sm" id="btnRefreshBf">üîÑ Atualizar</button>
                </div>
                <div class="card-body">
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Idade</th>
                                    <th>Telefone</th>
                                    <th>Regi√£o</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tblBenef">
                                <tr><td colspan="5" class="empty"><div class="empty-icon">üë•</div>Nenhum benefici√°rio</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- INSCRI√á√ïES -->
        <div class="page" id="page-inscricoes">
            <div class="card">
                <div class="card-header">‚ûï Nova Inscri√ß√£o</div>
                <div class="card-body">
                    <form id="formInsc">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Benefici√°rio <span class="req">*</span></label>
                                <select class="form-select" id="inBenef" required>
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Evento <span class="req">*</span></label>
                                <select class="form-select" id="inEvento" required>
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="inStatus">
                                    <option value="inscrito">üìù Inscrito</option>
                                    <option value="confirmado">‚úÖ Confirmado</option>
                                    <option value="lista_espera">‚è≥ Lista de Espera</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">üíæ Realizar Inscri√ß√£o</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span>üìã Inscri√ß√µes Realizadas</span>
                    <button class="btn btn-secondary btn-sm" id="btnRefreshIn">üîÑ Atualizar</button>
                </div>
                <div class="card-body">
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Benefici√°rio</th>
                                    <th>Evento</th>
                                    <th>Status</th>
                                    <th>Presen√ßa</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tblInsc">
                                <tr><td colspan="5" class="empty"><div class="empty-icon">üìã</div>Nenhuma inscri√ß√£o</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONFIGURA√á√ÉO -->
        <div class="page" id="page-config">
            <div class="config-box">
                <h3>üîê Configura√ß√£o do Supabase</h3>
                <p style="margin-bottom: 20px; opacity: 0.8;">
                    Insira suas credenciais do Supabase. Encontre em: Settings ‚Üí API
                </p>
                <div class="config-grid">
                    <div>
                        <div class="config-label">URL do Projeto</div>
                        <input type="text" class="config-input" id="cfgUrl" placeholder="https://xxxxx.supabase.co">
                    </div>
                    <div>
                        <div class="config-label">Anon Key (Chave P√∫blica)</div>
                        <input type="text" class="config-input" id="cfgKey" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
                    </div>
                </div>
                <button class="btn btn-primary" id="btnConectar">üîó Conectar ao Supabase</button>
                <button class="btn btn-secondary" id="btnTestar" style="margin-left: 10px;">üß™ Testar Conex√£o</button>
            </div>

            <div class="card">
                <div class="card-header">üìñ Instru√ß√µes</div>
                <div class="card-body">
                    <p><strong>1.</strong> Acesse seu projeto no <a href="https://supabase.com/dashboard" target="_blank" style="color: #10B981;">Supabase Dashboard</a></p>
                    <p style="margin-top: 10px;"><strong>2.</strong> V√° em <strong>Settings</strong> ‚Üí <strong>API</strong></p>
                    <p style="margin-top: 10px;"><strong>3.</strong> Copie a <strong>Project URL</strong> e a <strong>anon public key</strong></p>
                    <p style="margin-top: 10px;"><strong>4.</strong> Cole os valores acima e clique em <strong>Conectar</strong></p>
                </div>
            </div>
        </div>

    </main>

    <!-- Toast Container -->
    <div class="toast-container" id="toasts"></div>

    <script>
        // ========================================
        // VARI√ÅVEIS GLOBAIS
        // ========================================
        let supabaseClient = null;
        let eventos = [];
        let beneficiarios = [];
        let inscricoes = [];

        // Credenciais do Supabase (pr√©-configuradas)
        const SUPABASE_URL = 'https://qjcswzccdhgpvmsqofap.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_zyxdXbQNX6A7wm1SXbqbPw_yi31OX5I';

        // ========================================
        // NAVEGA√á√ÉO - FUNCIONA 100%
        // ========================================
        document.getElementById('mainNav').addEventListener('click', function(e) {
            if (e.target.classList.contains('nav-btn')) {
                // Remove active de todos
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                
                // Adiciona active no clicado
                e.target.classList.add('active');
                const pageId = 'page-' + e.target.getAttribute('data-page');
                document.getElementById(pageId).classList.add('active');
                
                console.log('Navegou para:', pageId);
            }
        });

        // ========================================
        // INICIALIZA√á√ÉO
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Sistema iniciado!');
            
            // Preencher campos com credenciais pr√©-configuradas
            document.getElementById('cfgUrl').value = SUPABASE_URL;
            document.getElementById('cfgKey').value = SUPABASE_KEY;
            
            // Verificar se a biblioteca Supabase carregou
            if (typeof window.supabase === 'undefined') {
                console.error('‚ùå Biblioteca Supabase N√ÉO carregou!');
                document.getElementById('statusText').textContent = 'Sem internet';
                toast('error', 'Conecte-se √† internet para usar o sistema');
            } else {
                console.log('‚úÖ Biblioteca Supabase carregada!');
                // Conectar automaticamente
                conectarAuto();
            }

            // Event Listeners dos formul√°rios
            document.getElementById('formEvento').addEventListener('submit', salvarEvento);
            document.getElementById('formBenef').addEventListener('submit', salvarBeneficiario);
            document.getElementById('formInsc').addEventListener('submit', salvarInscricao);
            
            // Bot√µes de configura√ß√£o
            document.getElementById('btnConectar').addEventListener('click', function() { conectar(false); });
            document.getElementById('btnTestar').addEventListener('click', testarConexao);
            
            // Bot√µes de refresh
            document.getElementById('btnRefreshEv').addEventListener('click', carregarEventos);
            document.getElementById('btnRefreshBf').addEventListener('click', carregarBeneficiarios);
            document.getElementById('btnRefreshIn').addEventListener('click', carregarInscricoes);
        });

        // ========================================
        // CONEX√ÉO SUPABASE
        // ========================================
        
        // Conex√£o autom√°tica com credenciais pr√©-configuradas
        async function conectarAuto() {
            try {
                console.log('Tentando conectar ao Supabase...');
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                
                // Testar conex√£o
                const { data, error } = await supabaseClient.from('eventos').select('count', { count: 'exact', head: true });
                
                if (error) {
                    console.error('Erro na conex√£o:', error);
                    throw error;
                }

                // Atualizar status
                document.getElementById('statusDot').classList.add('connected');
                document.getElementById('statusText').textContent = 'Conectado';
                console.log('‚úÖ Conectado ao Supabase!');
                
                toast('success', 'Conectado ao Supabase!');

                // Carregar dados
                await carregarTudo();

            } catch (error) {
                console.error('Erro ao conectar:', error);
                document.getElementById('statusDot').classList.remove('connected');
                document.getElementById('statusText').textContent = 'Erro: ' + (error.message || 'Falha na conex√£o');
                toast('error', 'Erro: ' + (error.message || 'Verifique as credenciais'));
            }
        }
        
        async function conectar(silent) {
            // Verificar se a biblioteca carregou
            if (typeof window.supabase === 'undefined') {
                toast('error', 'Biblioteca n√£o carregou. Verifique sua conex√£o com a internet.');
                console.error('Supabase library not loaded. Make sure you have internet connection.');
                return;
            }

            const url = document.getElementById('cfgUrl').value.trim();
            const key = document.getElementById('cfgKey').value.trim();

            if (!url || !key) {
                if (!silent) toast('error', 'Preencha URL e Key');
                return;
            }

            try {
                supabaseClient = window.supabase.createClient(url, key);
                
                // Testar conex√£o
                const { error } = await supabaseClient.from('eventos').select('count', { count: 'exact', head: true });
                if (error) throw error;

                // Salvar credenciais
                localStorage.setItem('supabaseUrl', url);
                localStorage.setItem('supabaseKey', key);

                // Atualizar status
                document.getElementById('statusDot').classList.add('connected');
                document.getElementById('statusText').textContent = 'Conectado';
                
                if (!silent) toast('success', 'Conectado com sucesso!');

                // Carregar dados
                await carregarTudo();

            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('statusDot').classList.remove('connected');
                document.getElementById('statusText').textContent = 'Erro na conex√£o';
                if (!silent) toast('error', 'Erro: ' + error.message);
            }
        }

        async function testarConexao() {
            if (!supabaseClient) {
                toast('error', 'Configure a conex√£o primeiro');
                return;
            }
            try {
                const { error } = await supabaseClient.from('eventos').select('count', { count: 'exact', head: true });
                if (error) throw error;
                toast('success', 'Conex√£o OK!');
            } catch (error) {
                toast('error', 'Falha: ' + error.message);
            }
        }

        // ========================================
        // CARREGAR DADOS
        // ========================================
        async function carregarTudo() {
            await carregarEventos();
            await carregarBeneficiarios();
            await carregarInscricoes();
            await carregarStats();
        }

        async function carregarStats() {
            if (!supabaseClient) return;
            try {
                const { count: ev } = await supabaseClient.from('eventos').select('*', { count: 'exact', head: true });
                const { count: bf } = await supabaseClient.from('beneficiarios').select('*', { count: 'exact', head: true }).eq('ativo', true);
                const { count: insc } = await supabaseClient.from('inscricoes').select('*', { count: 'exact', head: true });
                const { data: presData } = await supabaseClient.from('inscricoes').select('presenca');
                
                document.getElementById('statEventos').textContent = ev || 0;
                document.getElementById('statBenef').textContent = bf || 0;
                document.getElementById('statInsc').textContent = insc || 0;
                
                if (presData && presData.length > 0) {
                    const pres = presData.filter(p => p.presenca).length;
                    const taxa = Math.round((pres / presData.length) * 100);
                    document.getElementById('statPresenca').textContent = taxa + '%';
                }
            } catch (e) {
                console.error('Erro stats:', e);
            }
        }

        async function carregarEventos() {
            if (!supabaseClient) return;
            try {
                const { data, error } = await supabaseClient.from('eventos').select('*').order('data_evento', { ascending: true });
                if (error) throw error;
                eventos = data || [];
                renderEventos();
                renderProximos();
                atualizarSelectEventos();
            } catch (e) {
                console.error('Erro eventos:', e);
            }
        }

        async function carregarBeneficiarios() {
            if (!supabaseClient) return;
            try {
                const { data, error } = await supabaseClient.from('beneficiarios').select('*').eq('ativo', true).order('nome');
                if (error) throw error;
                beneficiarios = data || [];
                renderBeneficiarios();
                atualizarSelectBeneficiarios();
            } catch (e) {
                console.error('Erro beneficiarios:', e);
            }
        }

        async function carregarInscricoes() {
            if (!supabaseClient) return;
            try {
                const { data, error } = await supabaseClient.from('inscricoes').select('*, beneficiarios(nome), eventos(nome)').order('data_inscricao', { ascending: false });
                if (error) throw error;
                inscricoes = data || [];
                renderInscricoes();
            } catch (e) {
                console.error('Erro inscricoes:', e);
            }
        }

        // ========================================
        // RENDERIZA√á√ÉO
        // ========================================
        function renderEventos() {
            const tbody = document.getElementById('tblEventos');
            if (eventos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty"><div class="empty-icon">üìÖ</div>Nenhum evento cadastrado</td></tr>';
                return;
            }
            tbody.innerHTML = eventos.map(e => `
                <tr>
                    <td><strong>${e.nome}</strong></td>
                    <td>${badgeTipo(e.tipo_evento)}</td>
                    <td>${formatData(e.data_evento)}</td>
                    <td>${e.vagas}</td>
                    <td><button class="btn btn-danger" onclick="excluirEvento('${e.id}')">üóëÔ∏è</button></td>
                </tr>
            `).join('');
        }

        function renderProximos() {
            const tbody = document.getElementById('tblProximos');
            const hoje = new Date();
            const proximos = eventos.filter(e => new Date(e.data_evento) >= hoje).slice(0, 5);
            
            if (proximos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:30px;color:#6b7280;">Nenhum evento pr√≥ximo</td></tr>';
                return;
            }
            tbody.innerHTML = proximos.map(e => `
                <tr>
                    <td><strong>${e.nome}</strong></td>
                    <td>${badgeTipo(e.tipo_evento)}</td>
                    <td>${formatData(e.data_evento)}</td>
                    <td>${e.vagas}</td>
                </tr>
            `).join('');
        }

        function renderBeneficiarios() {
            const tbody = document.getElementById('tblBenef');
            if (beneficiarios.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty"><div class="empty-icon">üë•</div>Nenhum benefici√°rio</td></tr>';
                return;
            }
            tbody.innerHTML = beneficiarios.map(b => `
                <tr>
                    <td><strong>${b.nome}</strong></td>
                    <td>${b.idade || '-'}</td>
                    <td>${b.telefone || '-'}</td>
                    <td><span class="badge badge-blue">${b.regiao}</span></td>
                    <td><button class="btn btn-danger" onclick="excluirBeneficiario('${b.id}')">üóëÔ∏è</button></td>
                </tr>
            `).join('');
        }

        function renderInscricoes() {
            const tbody = document.getElementById('tblInsc');
            if (inscricoes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty"><div class="empty-icon">üìã</div>Nenhuma inscri√ß√£o</td></tr>';
                return;
            }
            tbody.innerHTML = inscricoes.map(i => `
                <tr>
                    <td><strong>${i.beneficiarios?.nome || 'N/A'}</strong></td>
                    <td>${i.eventos?.nome || 'N/A'}</td>
                    <td>${badgeStatus(i.status)}</td>
                    <td>
                        <button class="btn btn-sm ${i.presenca ? 'btn-primary' : 'btn-secondary'}" onclick="togglePresenca('${i.id}', ${!i.presenca})">
                            ${i.presenca ? '‚úÖ Sim' : '‚¨ú N√£o'}
                        </button>
                    </td>
                    <td><button class="btn btn-danger" onclick="excluirInscricao('${i.id}')">üóëÔ∏è</button></td>
                </tr>
            `).join('');
        }

        function atualizarSelectEventos() {
            const sel = document.getElementById('inEvento');
            sel.innerHTML = '<option value="">Selecione...</option>' + eventos.filter(e => e.status === 'ativo' || !e.status).map(e => `<option value="${e.id}">${e.nome}</option>`).join('');
        }

        function atualizarSelectBeneficiarios() {
            const sel = document.getElementById('inBenef');
            sel.innerHTML = '<option value="">Selecione...</option>' + beneficiarios.map(b => `<option value="${b.id}">${b.nome}</option>`).join('');
        }

        // ========================================
        // SALVAR DADOS
        // ========================================
        async function salvarEvento(e) {
            e.preventDefault();
            if (!supabaseClient) { toast('error', 'Configure a conex√£o primeiro'); return; }

            try {
                const { error } = await supabaseClient.from('eventos').insert([{
                    nome: document.getElementById('evNome').value,
                    tipo_evento: document.getElementById('evTipo').value,
                    data_evento: document.getElementById('evData').value,
                    vagas: parseInt(document.getElementById('evVagas').value) || 50,
                    vagas_disponiveis: parseInt(document.getElementById('evVagas').value) || 50,
                    local: document.getElementById('evLocal').value || null,
                    status: 'ativo'
                }]);
                if (error) throw error;
                toast('success', 'Evento cadastrado!');
                document.getElementById('formEvento').reset();
                await carregarEventos();
                await carregarStats();
            } catch (error) {
                toast('error', 'Erro: ' + error.message);
            }
        }

        async function salvarBeneficiario(e) {
            e.preventDefault();
            if (!supabaseClient) { toast('error', 'Configure a conex√£o primeiro'); return; }

            try {
                const { error } = await supabaseClient.from('beneficiarios').insert([{
                    nome: document.getElementById('bfNome').value,
                    idade: parseInt(document.getElementById('bfIdade').value) || null,
                    telefone: document.getElementById('bfTel').value || null,
                    email: document.getElementById('bfEmail').value || null,
                    regiao: document.getElementById('bfRegiao').value,
                    ativo: true
                }]);
                if (error) throw error;
                toast('success', 'Benefici√°rio cadastrado!');
                document.getElementById('formBenef').reset();
                await carregarBeneficiarios();
                await carregarStats();
            } catch (error) {
                toast('error', 'Erro: ' + error.message);
            }
        }

        async function salvarInscricao(e) {
            e.preventDefault();
            if (!supabaseClient) { toast('error', 'Configure a conex√£o primeiro'); return; }

            try {
                const { error } = await supabaseClient.from('inscricoes').insert([{
                    beneficiario_id: document.getElementById('inBenef').value,
                    evento_id: document.getElementById('inEvento').value,
                    status: document.getElementById('inStatus').value,
                    presenca: false
                }]);
                if (error) {
                    if (error.code === '23505') throw new Error('J√° inscrito neste evento');
                    throw error;
                }
                toast('success', 'Inscri√ß√£o realizada!');
                document.getElementById('formInsc').reset();
                await carregarInscricoes();
                await carregarStats();
            } catch (error) {
                toast('error', 'Erro: ' + error.message);
            }
        }

        // ========================================
        // A√á√ïES
        // ========================================
        async function togglePresenca(id, valor) {
            if (!supabaseClient) return;
            try {
                const { error } = await supabaseClient.from('inscricoes').update({ presenca: valor }).eq('id', id);
                if (error) throw error;
                await carregarInscricoes();
                await carregarStats();
            } catch (e) {
                toast('error', 'Erro ao atualizar');
            }
        }

        async function excluirEvento(id) {
            if (!confirm('Excluir este evento?')) return;
            try {
                const { error } = await supabaseClient.from('eventos').delete().eq('id', id);
                if (error) throw error;
                toast('success', 'Evento exclu√≠do');
                await carregarTudo();
            } catch (e) {
                toast('error', 'Erro ao excluir');
            }
        }

        async function excluirBeneficiario(id) {
            if (!confirm('Excluir este benefici√°rio?')) return;
            try {
                const { error } = await supabaseClient.from('beneficiarios').update({ ativo: false }).eq('id', id);
                if (error) throw error;
                toast('success', 'Benefici√°rio exclu√≠do');
                await carregarTudo();
            } catch (e) {
                toast('error', 'Erro ao excluir');
            }
        }

        async function excluirInscricao(id) {
            if (!confirm('Cancelar esta inscri√ß√£o?')) return;
            try {
                const { error } = await supabaseClient.from('inscricoes').delete().eq('id', id);
                if (error) throw error;
                toast('success', 'Inscri√ß√£o cancelada');
                await carregarTudo();
            } catch (e) {
                toast('error', 'Erro ao cancelar');
            }
        }

        // ========================================
        // UTILIT√ÅRIOS
        // ========================================
        function formatData(str) {
            if (!str) return '-';
            return new Date(str).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        function badgeTipo(tipo) {
            const tipos = {
                'inclusao_digital': '<span class="badge badge-blue">üíª Inclus√£o Digital</span>',
                'capacitacao_profissional': '<span class="badge badge-purple">üíº Capacita√ß√£o</span>',
                'campanha_saude': '<span class="badge badge-green">üè• Sa√∫de</span>',
                'outro': '<span class="badge badge-yellow">üìå Outro</span>'
            };
            return tipos[tipo] || '<span class="badge">' + tipo + '</span>';
        }

        function badgeStatus(status) {
            const s = {
                'inscrito': '<span class="badge badge-blue">üìù Inscrito</span>',
                'confirmado': '<span class="badge badge-green">‚úÖ Confirmado</span>',
                'lista_espera': '<span class="badge badge-yellow">‚è≥ Espera</span>'
            };
            return s[status] || '<span class="badge">' + status + '</span>';
        }

        function toast(type, msg) {
            const container = document.getElementById('toasts');
            const t = document.createElement('div');
            t.className = 'toast ' + type;
            t.innerHTML = `
                <span>${type === 'success' ? '‚úÖ' : '‚ùå'}</span>
                <span>${msg}</span>
                <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
            `;
            container.appendChild(t);
            setTimeout(() => t.remove(), 4000);
        }
    </script>
</body>
</html>
